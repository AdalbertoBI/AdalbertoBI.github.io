<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WhatIntegra - WhatsApp Web</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/styles.css" />
    <link rel="stylesheet" href="./assets/link-preview.css" />
    
    <!-- WhatIntegra Modules -->
    <script src="./assets/config.js"></script>
    <script src="./assets/utils.js"></script>
    <script src="./assets/connectivity.js"></script>
    <script src="./assets/ui.js"></script>
    <script src="./assets/auth.js"></script>
    <script src="./assets/whatsapp.js"></script>
  </head>
  <body>
    <!-- Tela de Login -->
    <main id="loginScreen" class="login-container">
      <section class="login-card">
        <h1>🚀 WhatIntegra</h1>
        <p class="login-subtitle">Acesse seu WhatsApp Web de qualquer lugar</p>

        <form id="loginForm">
          <label for="username">Usuário</label>
          <input id="username" name="username" required />

          <label for="password">Senha</label>
          <input id="password" name="password" type="password" autocomplete="current-password" required />

          <button type="submit" id="loginBtn">Entrar</button>
          <button type="button" id="testConnectionBtn" class="btn-secondary">🧪 Testar Conectividade</button>
        </form>

        <output id="status" class="status" aria-live="polite"></output>

        <div id="configAlert" class="config-alert hidden-alert">
          <div class="alert-content">
            <h3>⚠️ Configuração Necessária</h3>
            <p>Para usar o WhatsApp Web, você precisa autorizar os servidores locais primeiro.</p>
            <a href="./setup.html" class="config-btn">🔧 Configurar Agora</a>
          </div>
        </div>

        <details class="help">
          <summary>Como funciona?</summary>
          <ul>
            <li>WhatsApp Web compartilhado através de servidor local</li>
            <li>Sessão protegida na sua máquina</li>
            <li>Acesso de qualquer dispositivo após autenticação</li>
          </ul>
        </details>
      </section>
    </main>

    <!-- Interface WhatsApp Web -->
    <main id="whatsappScreen" class="whatsapp-container hidden">
      <!-- Header -->
      <header class="whatsapp-header">
        <div class="header-left">
          <h1>🚀 WhatIntegra</h1>
          <div class="connection-status" id="connectionStatus">
            <span class="status-dot"></span>
            <span id="statusText">Conectando...</span>
          </div>
        </div>
        <div class="header-right">
          <span id="displayUser" class="username"></span>
          <button id="logoutBtn" class="btn-icon" title="Sair">🚪</button>
        </div>
      </header>

      <!-- QR Code Screen -->
      <div id="qrScreen" class="qr-screen">
        <div class="qr-container">
          <h2>📱 Conecte seu WhatsApp</h2>
          <p>Escaneie o código QR com seu celular</p>
          <div id="qrCode" class="qr-code"></div>
          <div class="qr-instructions">
            <ol>
              <li>Abra o WhatsApp no seu celular</li>
              <li>Vá em <strong>Menu > WhatsApp Web</strong></li>
              <li>Aponte a câmera para este código</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- Main WhatsApp Interface -->
      <div id="mainInterface" class="main-interface hidden">
        <!-- Sidebar com conversas -->
        <aside class="sidebar">
          <div class="sidebar-header">
            <h3>Conversas</h3>
            <div class="search-box">
              <input type="text" id="searchChats" placeholder="🔍 Buscar conversas..." />
            </div>
          </div>
          <div class="chats-list" id="chatsList">
            <div class="loading-chats">
              <div class="spinner"></div>
              <span>Carregando conversas...</span>
            </div>
          </div>
        </aside>

        <!-- Área de chat -->
        <section class="chat-area">
          <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-content">
              <h2>💬 WhatIntegra</h2>
              <p>Selecione uma conversa para começar</p>
              <div class="feature-list">
                <div class="feature">✅ WhatsApp Web sincronizado</div>
                <div class="feature">🔄 Tempo real para múltiplos usuários</div>
                <div class="feature">🔒 Dados protegidos localmente</div>
              </div>
            </div>
          </div>

          <div class="chat-container hidden" id="chatContainer">
            <!-- Header do chat -->
            <div class="chat-header">
              <div class="contact-info">
                <div class="contact-avatar" id="chatAvatar">👤</div>
                <div class="contact-details">
                  <h4 id="chatName">Selecione um chat</h4>
                  <span class="contact-status" id="chatStatus">online</span>
                </div>
              </div>
              <div class="chat-actions">
                <button class="btn-icon" title="Buscar mensagens">🔍</button>
                <button class="btn-icon" title="Mais opções">⋮</button>
              </div>
            </div>

            <!-- Mensagens -->
            <div class="messages-area" id="messagesArea">
              <div class="loading-messages">
                <div class="spinner"></div>
                <span>Carregando mensagens...</span>
              </div>
            </div>

            <!-- Indicador de digitação -->
            <div id="typingIndicator" class="typing-indicator hidden">
              <div class="typing-animation">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
              </div>
              <span id="typingText">digitando...</span>
            </div>

            <!-- Input de mensagem -->
            <div class="message-input-area">
              <!-- File input oculto -->
              <input type="file" id="fileInput" class="hidden" accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.txt" multiple title="Selecionar arquivos para anexar" aria-label="Anexar arquivos">
              
              <div class="message-input-container">
                <button id="attachBtn" class="btn-icon" title="Anexar">📎</button>
                <button id="voiceBtn" class="btn-icon voice-btn" title="Gravar áudio">🎤</button>
                <button id="emojiBtn" class="btn-icon" title="Emojis">😊</button>
                <input 
                  type="text" 
                  id="messageInput" 
                  placeholder="Digite uma mensagem..." 
                  maxlength="1000"
                />
                <button id="sendBtn" class="btn-send" title="Enviar">📤</button>
              </div>
              
              <!-- Seletor de Emojis -->
              <div id="emojiPicker" class="emoji-picker hidden">
                <div class="emoji-picker-header">
                  <div class="emoji-categories">
                    <button class="emoji-category active" data-category="people">😊</button>
                    <button class="emoji-category" data-category="nature">🌲</button>
                    <button class="emoji-category" data-category="food">🍎</button>
                    <button class="emoji-category" data-category="activities">⚽</button>
                    <button class="emoji-category" data-category="travel">🚗</button>
                    <button class="emoji-category" data-category="objects">💡</button>
                    <button class="emoji-category" data-category="symbols">❤️</button>
                  </div>
                </div>
                <div class="emoji-picker-content">
                  <div class="emoji-grid" id="emojiGrid">
                    <!-- Emojis serão carregados aqui via JavaScript -->
                  </div>
                </div>
              </div>

              <!-- Modal de gravação de voz -->
              <div id="voiceModal" class="voice-modal hidden">
                <div class="voice-modal-content">
                  <div class="voice-recording-area">
                    <div class="recording-indicator">
                      <div class="recording-dot"></div>
                      <span id="recordingTime">00:00</span>
                    </div>
                    <div class="voice-controls">
                      <button id="cancelRecordingBtn" class="voice-control-btn cancel">❌</button>
                      <button id="stopRecordingBtn" class="voice-control-btn record">⏹️</button>
                      <button id="sendVoiceBtn" class="voice-control-btn send hidden">📤</button>
                    </div>
                    <div class="recording-message">Gravando mensagem de voz...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="./assets/app-main.js"></script>
  </body>
</html>
